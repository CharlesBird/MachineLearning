import tensorflow as tf

"""
ä»¥å‡æ–¹å·®è¯¯å·®å‡½æ•°ä¸ºä¾‹ï¼Œç»è¿‡ tf.keras.losses.mse(æˆ– tf.keras.losses.MSE)è¿”å›æ¯ä¸ªæ ·æœ¬
ä¸Šçš„è¯¯å·®å€¼ï¼Œæœ€åå–è¯¯å·®çš„å‡å€¼ä½œä¸ºå½“å‰ batch çš„è¯¯å·®ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ ‡é‡
"""
out = tf.random.uniform([4, 10])  # éšæœºæ¨¡æ‹Ÿç½‘ç»œè¾“å‡º
y = tf.constant([2, 3, 2, 0])  # éšæœºæ„é€ æ ·æœ¬çœŸå®æ ‡ç­¾
y = tf.one_hot(y, depth=10)  # one-hot ç¼–ç 
loss = tf.keras.losses.mse(y, out)  # è®¡ç®—æ¯ä¸ªæ ·æœ¬çš„ MSE
loss = tf.reduce_mean(loss)  # å¹³å‡ MSE
print(loss)


"""
å‘é‡æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æ•°æ®è½½ä½“ï¼Œå¦‚åœ¨å…¨è¿æ¥å±‚å’Œå·ç§¯ç¥ç»ç½‘ç»œå±‚ä¸­ï¼Œåç½®å¼ é‡ğ’ƒå°±
ä½¿ç”¨å‘é‡æ¥è¡¨ç¤ºã€‚
"""
# z=wx,æ¨¡æ‹Ÿè·å¾—æ¿€æ´»å‡½æ•°çš„è¾“å…¥ z
z = tf.random.normal([4, 2])
b = tf.zeros([2])  # æ¨¡æ‹Ÿåç½®å‘é‡
z = z + b  # ç´¯åŠ åç½®

fc = tf.keras.layers.Dense(3)  # åˆ›å»ºä¸€å±‚ Wx+bï¼Œè¾“å‡ºèŠ‚ç‚¹ä¸º 3
fc.build(input_shape=(2, 4))  # é€šè¿‡ build å‡½æ•°åˆ›å»º W,b å¼ é‡ï¼Œè¾“å…¥èŠ‚ç‚¹ä¸º 4
print(fc.bias)  # æŸ¥çœ‹åç½®


"""
çŸ©é˜µä¹Ÿæ˜¯éå¸¸å¸¸è§çš„å¼ é‡ç±»å‹ï¼Œæ¯”å¦‚å…¨è¿æ¥å±‚çš„æ‰¹é‡è¾“å…¥ğ‘‹ = [ğ‘, ğ‘‘ğ‘–ğ‘›]ï¼Œå…¶ä¸­ğ‘è¡¨ç¤ºè¾“å…¥
æ ·æœ¬çš„ä¸ªæ•°ï¼Œå³ batch sizeï¼Œğ‘‘ğ‘–ğ‘›è¡¨ç¤ºè¾“å…¥ç‰¹å¾çš„é•¿åº¦ã€‚
"""
x = tf.random.normal([2, 4])
w = tf.ones([4, 3])  # å®šä¹‰ W å¼ é‡
b = tf.zeros([3])  # å®šä¹‰ b å¼ é‡
o = x@w+b  # X@W+b è¿ç®—
fc = tf.keras.layers.Dense(3)  # å®šä¹‰å…¨è¿æ¥å±‚çš„è¾“å‡ºèŠ‚ç‚¹ä¸º 3
fc.build(input_shape=(2, 4))  # å®šä¹‰å…¨è¿æ¥å±‚çš„è¾“å…¥èŠ‚ç‚¹ä¸º 4
print(fc.kernel)  # é€šè¿‡å…¨è¿æ¥å±‚çš„ kernel æˆå‘˜åæŸ¥çœ‹å…¶æƒå€¼çŸ©é˜µ W


"""
ä¸‰ç»´çš„å¼ é‡ä¸€ä¸ªå…¸å‹åº”ç”¨æ˜¯è¡¨ç¤ºåºåˆ—ä¿¡å·ï¼Œå®ƒçš„æ ¼å¼æ˜¯
ğ‘‹ = [ğ‘, ğ‘ ğ‘’ğ‘ğ‘¢ğ‘’ğ‘›ğ‘ğ‘’ ğ‘™ğ‘’ğ‘›, ğ‘“ğ‘’ğ‘ğ‘¡ğ‘¢ğ‘Ÿğ‘’ ğ‘™ğ‘’ğ‘›]
å…¶ä¸­ğ‘è¡¨ç¤ºåºåˆ—ä¿¡å·çš„æ•°é‡ï¼Œsequence len è¡¨ç¤ºåºåˆ—ä¿¡å·åœ¨æ—¶é—´ç»´åº¦ä¸Šçš„é‡‡æ ·ç‚¹æ•°ï¼Œfeature
len è¡¨ç¤ºæ¯ä¸ªç‚¹çš„ç‰¹å¾é•¿åº¦ã€‚
"""
# è‡ªåŠ¨åŠ è½½ IMDB ç”µå½±è¯„ä»·æ•°æ®é›†
(x_train,y_train),(x_test,y_test) = tf.keras.datasets.imdb.load_data(num_words=10000)
x_train = tf.keras.preprocessing.sequence.pad_sequences(x_train, maxlen=80)  # å°†å¥å­å¡«å……ã€æˆªæ–­ä¸ºç­‰é•¿ 80 ä¸ªå•è¯çš„å¥å­
print(x_train.shape)
# åˆ° x_train å¼ é‡çš„ shape ä¸º[25000,80]ï¼Œå…¶ä¸­ 25000 è¡¨ç¤ºå¥å­ä¸ªæ•°ï¼Œ80 è¡¨ç¤ºæ¯ä¸ªå¥å­å…± 80 ä¸ªå•è¯ï¼Œ
# æ¯ä¸ªå•è¯ä½¿ç”¨æ•°å­—ç¼–ç æ–¹å¼ã€‚æˆ‘ä»¬é€šè¿‡ layers.Embedding å±‚å°†æ•°å­—ç¼–ç çš„å•è¯è½¬æ¢ä¸ºé•¿åº¦ä¸º 100 ä¸ªè¯å‘é‡
embedding = tf.keras.layers.Embedding(10000, 100)  # åˆ›å»ºè¯å‘é‡ Embedding å±‚ç±»
out = embedding(x_train)  # å°†æ•°å­—ç¼–ç çš„å•è¯è½¬æ¢ä¸ºè¯å‘é‡
# ç»è¿‡ Embedding å±‚ç¼–ç åï¼Œå¥å­å¼ é‡çš„ shape å˜ä¸º[25000,80,100]ï¼Œå…¶ä¸­ 100 è¡¨ç¤ºæ¯ä¸ªå•è¯ç¼–ç ä¸ºé•¿åº¦ 100 çš„å‘é‡ã€‚
print(out.shape)


"""
4 ç»´å¼ é‡åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­åº”ç”¨çš„éå¸¸å¹¿æ³›ï¼Œå®ƒç”¨äºä¿å­˜ç‰¹å¾å›¾(Feature maps)æ•°æ®ï¼Œ
æ ¼å¼ä¸€èˆ¬å®šä¹‰ä¸º [ğ‘, â„, , ğ‘]
å…¶ä¸­ğ‘è¡¨ç¤ºè¾“å…¥çš„æ•°é‡ï¼Œh/wåˆ†å¸ƒè¡¨ç¤ºç‰¹å¾å›¾çš„é«˜å®½ï¼Œğ‘è¡¨ç¤ºç‰¹å¾å›¾çš„é€šé“æ•°ï¼Œéƒ¨åˆ†æ·±åº¦å­¦
ä¹ æ¡†æ¶ä¹Ÿä¼šä½¿ç”¨[ğ‘, ğ‘, â„, ]æ ¼å¼çš„ç‰¹å¾å›¾å¼ é‡ï¼Œä¾‹å¦‚ PyTorchã€‚å›¾ç‰‡æ•°æ®æ˜¯ç‰¹å¾å›¾çš„ä¸€ç§ï¼Œ
å¯¹äºå«æœ‰ RGB 3 ä¸ªé€šé“çš„å½©è‰²å›¾ç‰‡ï¼Œæ¯å¼ å›¾ç‰‡åŒ…å«äº† h è¡Œ w åˆ—åƒç´ ç‚¹ï¼Œæ¯ä¸ªç‚¹éœ€è¦ 3 ä¸ªæ•°
å€¼è¡¨ç¤º RGB é€šé“çš„é¢œè‰²å¼ºåº¦ï¼Œå› æ­¤ä¸€å¼ å›¾ç‰‡å¯ä»¥è¡¨ç¤ºä¸º[h,w, 3]
"""
x = tf.random.normal([4, 32, 32, 3])  # åˆ›å»º 32x32 çš„å½©è‰²å›¾ç‰‡è¾“å…¥ï¼Œä¸ªæ•°ä¸º 4
layer = tf.keras.layers.Conv2D(16, kernel_size=3)  # åˆ›å»ºå·ç§¯ç¥ç»ç½‘ç»œ
out = layer(x)  # å‰å‘è®¡ç®—
print(out.shape)  # è¾“å‡ºå¤§å°
# å·ç§¯æ ¸å¼ é‡ä¹Ÿæ˜¯ 4 ç»´å¼ é‡ï¼Œå¯ä»¥é€šè¿‡ kernel æˆå‘˜å˜é‡è®¿é—®
print(layer.kernel.shape)